######### PHP-deployment ##############
replicaCount: 1
namespace: dev
labels:
  dp: dp-nginx-php
  web: nginx-php
  tier: front-end
  ns: web-ns

image:
  php:
    repository: 074548180348.dkr.ecr.us-east-1.amazonaws.com/php-web-app
    tag: 3ca115c963a5365bf7fe1e08dced708d3932a775
  nginx:
    repository: nginx
    tag: latest

containers:
  php:
    name: php-ctr
    resources:
      requests:
        memory: "100Mi"
        cpu: "150m"
      limits:
        cpu: "400m"
        memory: "200Mi"

  nginx:
    name: nginx-ctr
    resources:
      requests:
        memory: "100Mi"
        cpu: "150m"
      limits:
        cpu: "400m"
        memory: "200Mi"

ports:
  nginx: 80
  php: 9000

#phpexporter env

env:
  PHP_FPM_WEB_LISTEN_ADDRESS:
    name: PHP_FPM_WEB_LISTEN_ADDRESS
    value: 9253
  PHP_FPM_WEB_TELEMETRY_PATH:
    name: PHP_FPM_WEB_TELEMETRY_PATH
    value: /metrics
  PHP_FPM_SCRAPE_URI:
    name: PHP_FPM_SCRAPE_URI
    value: tcp://127.0.0.1:9000/status
  PHP_FPM_FIX_PROCESS_COUNT:
    name: PHP_FPM_FIX_PROCESS_COUNT
    value: "false"
  PHP_FPM_LOG_LEVEL:
    name: PHP_FPM_LOG_LEVEL
    value: info

## node affinity
nodeAffinity:
  key: node
  operator: In
  values:
    - kubenode02
    - kubemaster
    - minikube

## toleration

tolerations:
  a:
    key: "color"
    operator: "Equal"
    value: "blue"
    effect: "NoSchedule"
    # tolerationSeconds: 10
  b:
    key: "node-role.kubernetes.io/control-plane"
    operator: "Exists"
    effect: "NoSchedule"
    # tolerationSeconds: 10

## cpu and memory limit
cpu:
  name: cpu-limit-range
  limits:
    default:
      cpu: "300m"
    defaultRequest:
      cpu: "100m"
    type: Container

mem:
  name: mem-limit-range
  limits:
    default:
      memory: "300Mi"
    defaultRequest:
      memory: "100Mi"
    type: Container

## Volumes

volumes:
  vol1: nginx-config-volume
  vol2: shared-files

volumeMounts:
  web: /var/www/html/
  nginxConf: /etc/nginx/conf.d/
## ConfigMap

configmap:
  nginx: nginx-config
  phpdb: php-db-configmap
  dbHost:
    statefullName: mariadb-st-0
    name: db-h
    namespace: db
    domain: svc.cluster.local

  dbUser: deepak

## secret

secret:
  phpdb: php-db-secret
  passwd: ZGVlcGFrMTIz
  db: ZWNvbWRi

## Service

service:
  port: 80
  targetPort: 80
  nodePort: 30006

########### Ingress #######################

ingress:
  create: true
  namespace: ingress-nginx
  name: ingress-php
  class: "nginx"
  rewriteTarget: /
  path: /
  backend:
    service:
      name: php-service-external
      port: 80
